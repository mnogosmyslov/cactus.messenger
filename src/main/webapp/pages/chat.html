<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" >
<head lang="en">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name = "description" content = "" />
    <meta name = "keywords" content = "" />
    <meta name = "robots" content = "" />

    <link th:href="@{/resources/css/bootstrap.css}" href="../resources/css/bootstrap.css" rel="stylesheet" />
    <link th:href="@{/resources/css/style.css}" href="../resources/css/style.css" rel="stylesheet" type="text/css"/>
    <link th:href="@{/resources/css/chatstyle.css}" href="../resources/css/chatstyle.css" rel="stylesheet" type="text/css"/>

    <title th:text="#{main.title}"></title>

</head>
<body ng-app="ChatApp">

    <div ng-controller="HeaderContacts">
    <header class="greenheader">
        <a id="logo" href="/cactus/"></a>

            <input id="user-settings" type="button" value="Settings" ng-click="setting = !setting" ng-class="{ active: setting }"/>
            <input id="user-contacts" type="button" value="Contacts" ng-click="contacts = !contacts" ng-class="{ active: contacts }"/>

    </header>
        <div class="contacts" ng-show="setting">
            <div ng-include="'/cactus/pages/settings_frag.html'"></div>
            <div class="back" ng-click="setting = false" ng-class="{ active: setting }"></div>
        </div>
        <div class="contacts" ng-show="contacts">
            <div ng-include="'/cactus/pages/contacts_frag.html'"></div>
            <div class="conshadow" ng-click="contacts = false" ng-class="{ active: contacts }"></div>
        </div>
    </div>

    <div ng-controller="ChatApi">

        <aside id="chatlist" style="overflow-y: scroll">
            <input ng-model="searchText" />
            <div>
                <ul>
                    <li ng-repeat="chat in chats | filter:searchText"
                        ng-class="{active:isActiveChat(chat.url)}"
                        ng-click="onClickChat(chat)">{{chat.title}}</li>
                </ul>
            </div>

        </aside>
        <main>
            <div id="chatPreView">
                <div ng-include="currentChat"></div>
                <div class="messages">
                <p ng-repeat="message in messages | orderBy:'-time':true" class="message">
                <time>{{message.time | date:'HH:mm'}}</time>
                <span ng-class="{self: message.self}">{{message.message}}</span>
                </p>
                </div>
            </div>
            <form ng-submit="addMessage()" name="messageForm">
                <input class="new_message" type="text" placeholder="Compose a new message..." ng-model="message" ng-model-options="{updateOn: blur}"/>
                <div class="info">
                    <span class="count" ng-bind="max - message.length" ng-class="{danger: message.length > max}">140</span>
                    <button ng-disabled="message.length > max || message.length === 0">Send</button>
                </div>
            </form>

        </main>

        <script type="text/ng-template" id="force_gripper.tpl.html">
            <div ng-include="'/cactus/pages/chats/force_gripper.html'"></div>
        </script>

        <script type="text/ng-template" id="policebox.tpl.html">
            <div ng-include="'/cactus/pages/chats/policebox.html'"></div>

        </script>
        <script type="text/ng-template" id="albus.tpl.html">
            <div ng-include="'/cactus/pages/chats/albus.html'"></div>
        </script>
        <script type="text/ng-template" id="sauron.tpl.html">
            <div ng-include="'/cactus/pages/chats/sauron.html'"></div>
        </script>
        <script type="text/ng-template" id="wenk-wenk.tpl.html">
            <div ng-include="'/cactus/pages/chats/wenk-wenk.html'"></div>
        </script>
    </div>

    <script th:src="@{/resources/js/jquery-2.1.3.min.js}" src="../resources/js/jquery-2.1.3.min.js"></script>
    <script th:src="@{/resources/js/sock.min.js}" src="../resources/js/sock.min.js"></script>
    <script th:src="@{/resources/js/stomp.min.js}" src="../resources/js/stomp.min.js"></script>
    <script th:src="@{/resources/js/angular.min.js}" src="../resources/js/angular.min.js"></script>
    <script src="https://code.angularjs.org/1.4.0-beta.1/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.2/angular-route.js"></script>
    <script th:src="@{/resources/js/lodash.min.js}" src="../resources/js/lodash.min.js"></script>
    <script src="//angular-ui.github.io/ui-router/release/angular-ui-router.js"></script>


    <script th:src="@{/resources/js/controllers/controller.js}" src="../resources/js/controllers/controller.js"></script>
    <script th:src="@{/resources/js/bootstrap.js}" src="../resources/js/bootstrap.js"></script>
    <script th:src="@{/resources/js/controllers/chat.js}" src="../resources/js/controllers/chat.js"></script>
    <script th:src="@{/resources/js/controllers/chatService.js}" src="../resources/js/controllers/chatService.js"></script>
</body>
</html>